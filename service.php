<?php    include_once "database.php";            function query($sql) {        $res = array();        $result = mysql_query($sql);        if($result == false) return null;        while($row = mysql_fetch_assoc($result)) {            array_push($res, $row);        }        return $res;    }        function update($sql) {        return mysql_query($sql);    }        function Order($name, $adate, $id) {        if($name == "")            $sql = "update t_appointment set name=null where adate='$adate' and id='$id';";        else $sql = "update t_appointment set name='$name' where adate='$adate' and id='$id';";        return update($sql);    }        function getMembers($adate){                return query("select distinct name from t_appointment where adate = '$adate';");    }        function Score($data, $adate) {        foreach($data as $item) {            $name = $item["name"];            $score = $item["score"];            $sql = "insert into t_score(name, score, adate) values('$name', $score, '$adate');";            update($sql);        }        return true;    }        function getResults() {        $sql = "select t.id, t.adate, t.name, r.score from t_appointment as t left join (select adate, name, round(avg(score), 2) as score from t_score group by adate, name) as r on t.adate=r.adate and t.name=r.name order by t.adate asc, r.score desc;";        return query($sql);    }        function main() {                global $g_sis_config;        $today = $g_sis_config["sharing"]["current"];            $method = $_GET["method"];                switch($method) {            case "members":                echo json_encode(getMembers($today));                break;            case "order":                $name = $_POST["name"];                $appointDate = $_POST["adate"];                $id = $_POST["id"];                echo Order($name, $appointDate, $id);                break;            case "score":                            $data = $_POST["scores"];                echo Score($data, $today);                break;            case "results":                echo json_encode(getResults());                break;            default:                break;        }        }        main();                        ?>